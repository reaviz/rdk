import{r as e}from"./index-1b03fe98.js";import{u as v,f as K,a as $,P as A,L as U}from"./motion-a00ca7d7.js";function I(){const n=e.useRef(!1);return v(()=>(n.current=!0,()=>{n.current=!1}),[]),n}function b(){const n=I(),[s,t]=e.useState(0),r=e.useCallback(()=>{n.current&&t(s+1)},[s]);return[e.useCallback(()=>K.postRender(r),[r]),s]}class B extends e.Component{getSnapshotBeforeUpdate(s){const t=this.props.childRef.current;if(t&&s.isPresent&&!this.props.isPresent){const r=this.props.sizeRef.current;r.height=t.offsetHeight||0,r.width=t.offsetWidth||0,r.top=t.offsetTop,r.left=t.offsetLeft}return null}componentDidUpdate(){}render(){return this.props.children}}function S({children:n,isPresent:s}){const t=e.useId(),r=e.useRef(null),m=e.useRef({width:0,height:0,top:0,left:0});return e.useInsertionEffect(()=>{const{width:d,height:l,top:f,left:h}=m.current;if(s||!r.current||!d||!l)return;r.current.dataset.motionPopId=t;const a=document.createElement("style");return document.head.appendChild(a),a.sheet&&a.sheet.insertRule(`
          [data-motion-pop-id="${t}"] {
            position: absolute !important;
            width: ${d}px !important;
            height: ${l}px !important;
            top: ${f}px !important;
            left: ${h}px !important;
          }
        `),()=>{document.head.removeChild(a)}},[s]),e.createElement(B,{isPresent:s,childRef:r,sizeRef:m},e.cloneElement(n,{ref:r}))}const P=({children:n,initial:s,isPresent:t,onExitComplete:r,custom:m,presenceAffectsLayout:d,mode:l})=>{const f=$(T),h=e.useId(),a=e.useMemo(()=>({id:h,initial:s,isPresent:t,custom:m,onExitComplete:o=>{f.set(o,!0);for(const u of f.values())if(!u)return;r&&r()},register:o=>(f.set(o,!1),()=>f.delete(o))}),d?void 0:[t]);return e.useMemo(()=>{f.forEach((o,u)=>f.set(u,!1))},[t]),e.useEffect(()=>{!t&&!f.size&&r&&r()},[t]),l==="popLayout"&&(n=e.createElement(S,{isPresent:t},n)),e.createElement(A.Provider,{value:a},n)};function T(){return new Map}function D(n){return e.useEffect(()=>()=>n(),[])}const p=n=>n.key||"";function G(n,s){n.forEach(t=>{const r=p(t);s.set(r,t)})}function H(n){const s=[];return e.Children.forEach(n,t=>{e.isValidElement(t)&&s.push(t)}),s}const _=({children:n,custom:s,initial:t=!0,onExitComplete:r,exitBeforeEnter:m,presenceAffectsLayout:d=!0,mode:l="sync"})=>{const f=e.useContext(U).forceRender||b()[0],h=I(),a=H(n);let o=a;const u=e.useRef(new Map).current,x=e.useRef(o),C=e.useRef(new Map).current,y=e.useRef(!0);if(v(()=>{y.current=!1,G(a,C),x.current=o}),D(()=>{y.current=!0,C.clear(),u.clear()}),y.current)return e.createElement(e.Fragment,null,o.map(c=>e.createElement(P,{key:p(c),isPresent:!0,initial:t?void 0:!1,presenceAffectsLayout:d,mode:l},c)));o=[...o];const g=x.current.map(p),M=a.map(p),L=g.length;for(let c=0;c<L;c++){const i=g[c];M.indexOf(i)===-1&&!u.has(i)&&u.set(i,void 0)}return l==="wait"&&u.size&&(o=[]),u.forEach((c,i)=>{if(M.indexOf(i)!==-1)return;const w=C.get(i);if(!w)return;const F=g.indexOf(i);let R=c;if(!R){const O=()=>{u.delete(i);const z=Array.from(C.keys()).filter(E=>!M.includes(E));if(z.forEach(E=>C.delete(E)),x.current=a.filter(E=>{const k=p(E);return k===i||z.includes(k)}),!u.size){if(h.current===!1)return;f(),r&&r()}};R=e.createElement(P,{key:p(w),isPresent:!1,onExitComplete:O,custom:s,presenceAffectsLayout:d,mode:l},w),u.set(i,R)}o.splice(F,0,R)}),o=o.map(c=>{const i=c.key;return u.has(i)?c:e.createElement(P,{key:p(c),isPresent:!0,presenceAffectsLayout:d,mode:l},c)}),e.createElement(e.Fragment,null,u.size?o:o.map(c=>e.cloneElement(c)))},j=e.createContext({close:()=>{}});export{_ as A,j as O};
